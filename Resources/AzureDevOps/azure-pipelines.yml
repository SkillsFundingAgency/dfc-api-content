variables:
    ArmTemplateRoot: '$(Build.SourcesDirectory)\Resources\ArmTemplates'
    SolutionBaseName: 'DFC.Api.Content'
    BuildPlatform: 'any cpu'
    BuildConfiguration: 'release'

resources:
  repositories:
  - repository: self
  - repository: dfc-devops
    type: github
    name: SkillsFundingAgency/dfc-devops
    ref: refs/tags/v1.11.1
    endpoint: 'GitHub (ESFA)'

pool:
  name: NCS - CI and CD
  demands:
    - msbuild
    - visualstudio

  jobs:

    #Build and test resources
    - template: AzureDevOpsTemplates/Build/dfc-arm-build.yml@dfc-devops
      parameters:
        ArmTemplateRoot: $(ArmTemplateRoot)
    
    #Build and test application
    - job: BuildDotNetCore
      displayName: Build-DotNetCore
      pool:
        name: NCS - CI and CD
        demands:
        - msbuild
        - visualstudio
    
      steps:
      # Build DFC.Api.ContentTasks
      - template: AzureDevOpsTemplates/Build/dfc-dotnetcore-build-sonar.yml@dfc-devops
        parameters:
          SolutionBaseName: $(SolutionBaseName)
          BuildPlatform: $(BuildPlatform)
          BuildConfiguration: $(BuildConfiguration)
          DotNetCoreVersion: 3.1.101 
          PublishWebApp: true
          TestSuffix: UnitTests